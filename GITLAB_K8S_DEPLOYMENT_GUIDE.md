# GitLab åœ¨ Kubernetes ä¸Šçš„å®Œæ•´éƒ¨ç½²æŒ‡å—

## ç›®å½•
1. [éƒ¨ç½²æ¶æ„æ¦‚è¿°](#1-éƒ¨ç½²æ¶æ„æ¦‚è¿°)
2. [GitLabé•œåƒé€‰æ‹©](#2-gitlabé•œåƒé€‰æ‹©)
3. [All-in-Oneéƒ¨ç½²æ–¹æ¡ˆ](#3-all-in-oneéƒ¨ç½²æ–¹æ¡ˆ)
4. [æŒä¹…åŒ–å­˜å‚¨é…ç½®](#4-æŒä¹…åŒ–å­˜å‚¨é…ç½®)
5. [GitLab Runneréƒ¨ç½²](#5-gitlab-runneréƒ¨ç½²)
6. [Runnerå·¥ä½œåŸç†è¯¦è§£](#6-runnerå·¥ä½œåŸç†è¯¦è§£)
7. [CI/CDå…¨æµç¨‹è¿è¡Œæœºåˆ¶](#7-cicdå…¨æµç¨‹è¿è¡Œæœºåˆ¶)
8. [Pythonä»£ç è¯„æµ‹ç³»ç»Ÿ](#8-pythonä»£ç è¯„æµ‹ç³»ç»Ÿ)
9. [GitLab CI/CDé…ç½®è¯¦è§£](#9-gitlab-cicdé…ç½®è¯¦è§£)
10. [å®‰å…¨å’Œæœ€ä½³å®è·µ](#10-å®‰å…¨å’Œæœ€ä½³å®è·µ)
11. [æ•…éšœæ’æŸ¥æŒ‡å—](#11-æ•…éšœæ’æŸ¥æŒ‡å—)

---

## 1. éƒ¨ç½²æ¶æ„æ¦‚è¿°

### 1.1 æ•´ä½“æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é˜¿é‡Œäº‘ Kubernetes é›†ç¾¤                    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Control Plane â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      3 Ã— Master Nodes (ç®¡ç†èŠ‚ç‚¹)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 Worker Nodes                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   Node 1    â”‚  â”‚   Node 2    â”‚  â”‚  Node 3  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ GitLab Pod  â”‚  â”‚Runner Pods  â”‚  â”‚ å­˜å‚¨èŠ‚ç‚¹  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ (All-in-One)â”‚  â”‚ (CI/CD)     â”‚  â”‚ (NAS)    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç»„ä»¶åˆ†å¸ƒ

| ç»„ä»¶ | éƒ¨ç½²æ–¹å¼ | èŠ‚ç‚¹åˆ†å¸ƒ | èµ„æºéœ€æ±‚ |
|-----|---------|---------|---------|
| **GitLab CE** | StatefulSet | å•èŠ‚ç‚¹éƒ¨ç½² | 4æ ¸/8GB |
| **GitLab Runner** | Deployment | å¤šèŠ‚ç‚¹åˆ†å¸ƒ | 1æ ¸/2GBÃ—3 |
| **å­˜å‚¨ç³»ç»Ÿ** | NAS/äº‘ç›˜ | å…±äº«å­˜å‚¨ | 100GB+ |
| **è´Ÿè½½å‡è¡¡** | Ingress/SLB | è¾¹ç¼˜èŠ‚ç‚¹ | - |

---

## 2. GitLabé•œåƒé€‰æ‹©

### 2.1 æ¨èç‰ˆæœ¬é…ç½®

```yaml
# æ ¸å¿ƒç»„ä»¶ç‰ˆæœ¬é€‰æ‹©
GitLab CEç‰ˆæœ¬: gitlab/gitlab-ce:16.6.2-ce.0
PostgreSQLç‰ˆæœ¬: postgres:13.12-alpine
Redisç‰ˆæœ¬: redis:7.0-alpine
Runnerç‰ˆæœ¬: gitlab/gitlab-runner:alpine-v16.6.1
```

### 2.2 é•œåƒæºé€‰æ‹©ï¼ˆé’ˆå¯¹é˜¿é‡Œäº‘ï¼‰

```yaml
# æ–¹å¼1ï¼šå®˜æ–¹é•œåƒ
image: gitlab/gitlab-ce:16.6.2-ce.0

# æ–¹å¼2ï¼šé˜¿é‡Œäº‘é•œåƒåŠ é€Ÿï¼ˆæ¨èï¼‰
image: registry.cn-hangzhou.aliyuncs.com/gitlab-cn/gitlab-ce:16.6.2-ce.0

# æ–¹å¼3ï¼šæç‹GitLabï¼ˆå›½å†…ç‰ˆæœ¬ï¼‰
image: registry.gitlab.cn/omnibus/gitlab-jh:16.6.2-jh.0
```

### 2.3 ç‰ˆæœ¬é€‰æ‹©å»ºè®®

| ç¯å¢ƒç±»å‹ | æ¨èç‰ˆæœ¬ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|---------|------|---------|
| **ç”Ÿäº§ç¯å¢ƒ** | 16.6.x (N-1ç‰ˆæœ¬) | ç¨³å®šæ€§é«˜ | ä¼ä¸šçº§åº”ç”¨ |
| **æµ‹è¯•ç¯å¢ƒ** | 16.7.x (æœ€æ–°ç‰ˆ) | æ–°åŠŸèƒ½ä½“éªŒ | åŠŸèƒ½éªŒè¯ |
| **å¼€å‘ç¯å¢ƒ** | 16.6.x | ä¸ç”Ÿäº§ä¸€è‡´ | å¼€å‘è°ƒè¯• |

---

## 3. All-in-Oneéƒ¨ç½²æ–¹æ¡ˆ

### 3.1 æ–¹æ¡ˆè¯´æ˜

**All-in-Oneä¼˜åŠ¿ï¼š**
- éƒ¨ç½²ç®€å•ï¼Œé…ç½®ç»Ÿä¸€
- ç®¡ç†æ–¹ä¾¿ï¼Œå•ç‚¹ç»´æŠ¤
- èµ„æºå ç”¨ç›¸å¯¹è¾ƒå°‘

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¸­å°å‹å›¢é˜Ÿï¼ˆ<50ç”¨æˆ·ï¼‰
- å¼€å‘/æµ‹è¯•ç¯å¢ƒ
- å¿«é€Ÿéƒ¨ç½²éœ€æ±‚

### 3.2 åŒ…å«çš„ç»„ä»¶

GitLab CEçš„Omnibusé•œåƒåŒ…å«ï¼š

âœ… **å·²åŒ…å«ç»„ä»¶ï¼š**
- GitLabæ ¸å¿ƒåº”ç”¨ï¼ˆRailsï¼‰
- å†…ç½®PostgreSQLæ•°æ®åº“
- å†…ç½®Redisç¼“å­˜
- Nginx WebæœåŠ¡å™¨
- Sidekiqåå°ä»»åŠ¡å¤„ç†
- GitLab Shellï¼ˆSSHè®¿é—®ï¼‰
- Prometheusç›‘æ§
- Grafanaä»ªè¡¨ç›˜
- GitLab Pages
- Container Registry

âŒ **éœ€è¦å•ç‹¬éƒ¨ç½²ï¼š**
- GitLab Runnerï¼ˆCI/CDæ‰§è¡Œå™¨ï¼‰

### 3.3 åŸºç¡€é…ç½®

```yaml
# namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: gitlab
  labels:
    name: gitlab
```

---

## 4. æŒä¹…åŒ–å­˜å‚¨é…ç½®

### 4.1 å­˜å‚¨éœ€æ±‚åˆ†æ

| ç›®å½•è·¯å¾„ | ç”¨é€” | é‡è¦æ€§ | æ¨èå¤§å° |
|---------|------|--------|---------|
| `/etc/gitlab` | é…ç½®æ–‡ä»¶ã€å¯†é’¥ | â­â­â­ | 10GB |
| `/var/opt/gitlab` | åº”ç”¨æ•°æ®ã€æ•°æ®åº“ã€Gitä»“åº“ | â­â­â­ | 100GB+ |
| `/var/log/gitlab` | æ—¥å¿—æ–‡ä»¶ | â­â­ | 20GB |

### 4.2 é˜¿é‡Œäº‘å­˜å‚¨é€‰æ‹©

**æ¨èï¼šé˜¿é‡Œäº‘NAS**
```yaml
ä¼˜åŠ¿ï¼š
- æ”¯æŒå¤šèŠ‚ç‚¹åŒæ—¶è¯»å†™ (ReadWriteMany)
- æ€§èƒ½ç¨³å®šï¼Œè‡ªåŠ¨æ‰©å®¹
- é€‚åˆGitLabçš„æ–‡ä»¶å­˜å‚¨éœ€æ±‚
- æ”¯æŒå¿«ç…§å¤‡ä»½

é…ç½®ç¤ºä¾‹ï¼š
storageClassName: alicloud-nas
accessModes: [ReadWriteMany]
```

**å¤‡é€‰ï¼šé˜¿é‡Œäº‘äº‘ç›˜**
```yaml
é™åˆ¶ï¼š
- åªæ”¯æŒå•èŠ‚ç‚¹æŒ‚è½½ (ReadWriteOnce)
- Podè¿ç§»éœ€è¦æ‰‹åŠ¨å¤„ç†
- ä¸é€‚åˆæœ‰çŠ¶æ€åº”ç”¨

é€‚ç”¨åœºæ™¯ï¼š
- æµ‹è¯•ç¯å¢ƒ
- å•èŠ‚ç‚¹éƒ¨ç½²
```

### 4.3 å­˜å‚¨é…ç½®æ–‡ä»¶

```yaml
# gitlab-storage.yaml
---
# NASå­˜å‚¨ç±»
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: gitlab-nas-storage
provisioner: nasplugin.csi.alibabacloud.com
parameters:
  server: "your-nas-id.cn-hangzhou.nas.aliyuncs.com"
  path: "/gitlab"
  vers: "3"
  options: "noresvport,nolock"
reclaimPolicy: Retain
allowVolumeExpansion: true

---
# GitLabæ•°æ®å­˜å‚¨
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: gitlab-data-pvc
  namespace: gitlab
spec:
  accessModes: [ReadWriteMany]
  storageClassName: gitlab-nas-storage
  resources:
    requests:
      storage: 100Gi

---
# GitLabé…ç½®å­˜å‚¨
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: gitlab-config-pvc
  namespace: gitlab
spec:
  accessModes: [ReadWriteMany]
  storageClassName: gitlab-nas-storage
  resources:
    requests:
      storage: 10Gi

---
# GitLabæ—¥å¿—å­˜å‚¨
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: gitlab-logs-pvc
  namespace: gitlab
spec:
  accessModes: [ReadWriteMany]
  storageClassName: gitlab-nas-storage
  resources:
    requests:
      storage: 20Gi
```

---

## 5. GitLab Runneréƒ¨ç½²

### 5.1 Runnerç±»å‹é€‰æ‹©

| æ‰§è¡Œå™¨ç±»å‹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ | æ¨èåº¦ |
|-----------|---------|--------|--------|
| **Kubernetesæ‰§è¡Œå™¨** | äº‘åŸç”Ÿåº”ç”¨ | âœ…è‡ªåŠ¨æ‰©ç¼©å®¹ âœ…èµ„æºç®¡ç† âŒé…ç½®å¤æ‚ | â­â­â­â­â­ |
| **Dockeræ‰§è¡Œå™¨** | é€šç”¨CI/CD | âœ…ç®€å• âœ…éš”ç¦»æ€§å¥½ âŒéœ€è¦DinD | â­â­â­â­ |
| **Shellæ‰§è¡Œå™¨** | ç®€å•è„šæœ¬ | âœ…æœ€ç®€å• âŒæ— éš”ç¦» âŒå®‰å…¨æ€§å·® | â­â­ |

### 5.2 RBACæƒé™é…ç½®

```yaml
# gitlab-runner-rbac.yaml
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: gitlab-runner
  namespace: gitlab

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: gitlab-runner
  namespace: gitlab
rules:
  # Podç®¡ç†æƒé™
  - apiGroups: [""]
    resources: ["pods", "pods/exec", "pods/log"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  # é…ç½®ç®¡ç†æƒé™
  - apiGroups: [""]
    resources: ["secrets", "configmaps"]
    verbs: ["get", "list", "create", "delete"]
  # å­˜å‚¨æƒé™
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["get", "create"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: gitlab-runner
  namespace: gitlab
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: gitlab-runner
subjects:
  - kind: ServiceAccount
    name: gitlab-runner
    namespace: gitlab
```

### 5.3 Runneré…ç½®éƒ¨ç½²

```yaml
# gitlab-runner-config.yaml
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gitlab-runner-config
  namespace: gitlab
data:
  config.toml: |
    concurrent = 10
    check_interval = 3
    
    [[runners]]
      name = "kubernetes-runner"
      url = "http://gitlab-service.gitlab.svc.cluster.local"
      token = "YOUR_REGISTRATION_TOKEN"
      executor = "kubernetes"
      
      [runners.kubernetes]
        namespace = "gitlab"
        image = "alpine:latest"
        privileged = true
        
        # èµ„æºé™åˆ¶
        cpu_request = "100m"
        cpu_limit = "1"
        memory_request = "128Mi"
        memory_limit = "1Gi"
        
        # æœåŠ¡è´¦å·
        service_account = "gitlab-runner"
        
        # ç¼“å­˜é…ç½®
        [[runners.kubernetes.volumes.pvc]]
          name = "cache"
          mount_path = "/cache"
          claim_name = "runner-cache-pvc"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gitlab-runner
  namespace: gitlab
spec:
  replicas: 3
  selector:
    matchLabels:
      app: gitlab-runner
  template:
    metadata:
      labels:
        app: gitlab-runner
    spec:
      serviceAccountName: gitlab-runner
      containers:
      - name: runner
        image: gitlab/gitlab-runner:alpine-v16.6.1
        command: ["gitlab-runner", "run"]
        volumeMounts:
        - name: config
          mountPath: /etc/gitlab-runner
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 1
            memory: 1Gi
      volumes:
      - name: config
        configMap:
          name: gitlab-runner-config
```

---

## 6. Runnerå·¥ä½œåŸç†è¯¦è§£

### 6.1 Runnerä¸GitLabé€šä¿¡æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                GitLab Server                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     GitLab API (Jobs Queue)         â”‚    â”‚
â”‚  â”‚  /api/v4/jobs/request (è½®è¯¢)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–² â–¼
              1.è½®è¯¢  â”‚ â”‚  2.è·å–Job
              (POST)  â”‚ â”‚  (Response)
                      â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               GitLab Runner                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Runnerè¿›ç¨‹ (é•¿è½®è¯¢ GitLab API)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     Kubernetesæ‰§è¡Œå™¨                â”‚    â”‚
â”‚  â”‚  åˆ›å»ºPod â†’ æ‰§è¡Œè„šæœ¬ â†’ æ¸…ç†Pod        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Podåˆ›å»ºå’Œæ‰§è¡Œæµç¨‹

```yaml
# æ­¥éª¤1: Runneræ¥æ”¶Job
Jobä¿¡æ¯:
  id: 1234
  image: "python:3.9"
  script: ["pytest tests/"]
  variables: {...}

# æ­¥éª¤2: åˆ›å»ºPodå®šä¹‰
apiVersion: v1
kind: Pod
metadata:
  name: runner-{token}-project-{id}-concurrent-{n}
  namespace: gitlab
spec:
  restartPolicy: Never
  containers:
  - name: build
    image: python:3.9
    command: ["/bin/bash", "-c"]
    args: ["pytest tests/"]
    env:
    - name: CI_JOB_ID
      value: "1234"

# æ­¥éª¤3: ç›‘æ§PodçŠ¶æ€
Pending â†’ ContainerCreating â†’ Running â†’ Succeeded/Failed

# æ­¥éª¤4: æ”¶é›†æ—¥å¿—å¹¶ä¸ŠæŠ¥
kubectl logs {pod-name} â†’ GitLab API

# æ­¥éª¤5: æ¸…ç†Pod
kubectl delete pod {pod-name}
```

### 6.3 è½®è¯¢æœºåˆ¶è¯¦è§£

```go
// Runneræ ¸å¿ƒè½®è¯¢é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰
for {
    // æ¯3ç§’è¯·æ±‚ä¸€æ¬¡GitLab
    response = HTTP.POST("/api/v4/jobs/request", {
        token: RUNNER_TOKEN,
        executor: "kubernetes",
        features: {"variable": true, "image": true}
    })
    
    if response.hasJob() {
        job = response.getJob()
        
        // åœ¨K8sä¸­åˆ›å»ºPodæ‰§è¡ŒJob
        pod := createPod(job)
        executeJob(pod, job)
        uploadLogs(job.id)
        updateJobStatus(job.id, result)
        cleanupPod(pod)
    }
    
    sleep(3) // ç­‰å¾…3ç§’ç»§ç»­è½®è¯¢
}
```

---

## 7. CI/CDå…¨æµç¨‹è¿è¡Œæœºåˆ¶

### 7.1 æ•´ä½“æ¶æ„è¿è¡Œæµç¨‹å›¾

```
å¼€å‘è€…æ¨é€ä»£ç 
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GitLab Server                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Git Repo      â”‚  â”‚  Pipeline       â”‚  â”‚  Artifacts      â”‚ â”‚
â”‚  â”‚   - main.py     â”‚  â”‚  Engine         â”‚  â”‚  Storage        â”‚ â”‚
â”‚  â”‚   - .gitlab-    â”‚  â”‚  - Job Queue    â”‚  â”‚  - build/       â”‚ â”‚
â”‚  â”‚     ci.yml      â”‚  â”‚  - Status       â”‚  â”‚  - reports/     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ æ£€æµ‹.gitlab-ci.yml        â†“ è½®è¯¢è·å–Job        â†‘ ä¸Šä¼ ç»“æœ
      â†“ åˆ›å»ºPipeline            â†“                    â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes Cluster                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 GitLab Runner Pod                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  gitlab-runner:alpine-v16.6.1                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - APIè½®è¯¢è¿›ç¨‹                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Podç®¡ç†å™¨                                    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - æ—¥å¿—æ”¶é›†å™¨                                   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  åˆ›å»ºä¸´æ—¶Job Pods â†“                                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ validate   â”‚  â”‚   build    â”‚  â”‚    test    â”‚  â”‚  deploy  â”‚ â”‚
â”‚  â”‚ Job Pod    â”‚  â”‚  Job Pod   â”‚  â”‚  Job Pod   â”‚  â”‚ Job Pod  â”‚ â”‚
â”‚  â”‚python:3.9  â”‚  â”‚ node:16    â”‚  â”‚ python:3.9 â”‚  â”‚kubectl   â”‚ â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚          â”‚ â”‚
â”‚  â”‚è¿è¡ŒçŠ¶æ€:    â”‚  â”‚è¿è¡ŒçŠ¶æ€:    â”‚  â”‚è¿è¡ŒçŠ¶æ€:    â”‚  â”‚è¿è¡ŒçŠ¶æ€: â”‚ â”‚
â”‚  â”‚âœ… Success  â”‚  â”‚âœ… Success  â”‚  â”‚âŒ Failed   â”‚  â”‚â¸ Skipped â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 PipelineçŠ¶æ€å˜åŒ–æ—¶åºå›¾

```
æ—¶é—´çº¿ â†’
GitLab   â”‚ Runner  â”‚ Pod1      â”‚ Pod2      â”‚ Pod3      â”‚ çŠ¶æ€
         â”‚         â”‚(validate) â”‚(build)    â”‚(test)     â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åˆ›å»º     â”‚         â”‚           â”‚           â”‚           â”‚ created
Pipeline â”‚         â”‚           â”‚           â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
å¯åŠ¨     â”‚ è½®è¯¢    â”‚           â”‚           â”‚           â”‚ pending
Pipeline â”‚ API     â”‚           â”‚           â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
åˆ†é…Job1 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”‚ åˆ›å»ºPod   â”‚           â”‚           â”‚ running
         â”‚ è·å–Job â”‚           â”‚           â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
Job1æ‰§è¡Œ â”‚         â”‚ è¿è¡Œä¸­... â”‚           â”‚           â”‚ running
         â”‚         â”‚ âœ…å®Œæˆ    â”‚           â”‚           â”‚
         â”‚         â”‚ ä¸Šä¼ ç»“æœ  â”‚           â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
åˆ†é…Job2 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”‚ é”€æ¯Pod   â”‚ åˆ›å»ºPod   â”‚           â”‚ running  
         â”‚ è·å–Job â”‚           â”‚           â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
Job2æ‰§è¡Œ â”‚         â”‚           â”‚ è¿è¡Œä¸­... â”‚           â”‚ running
         â”‚         â”‚           â”‚ âœ…å®Œæˆ    â”‚           â”‚
         â”‚         â”‚           â”‚ ä¸Šä¼ ç»“æœ  â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
åˆ†é…Job3 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚ é”€æ¯Pod   â”‚ åˆ›å»ºPod   â”‚ running
         â”‚ è·å–Job â”‚           â”‚           â”‚           â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
Job3æ‰§è¡Œ â”‚         â”‚           â”‚           â”‚ è¿è¡Œä¸­... â”‚ running
         â”‚         â”‚           â”‚           â”‚ âŒå¤±è´¥    â”‚
         â”‚         â”‚           â”‚           â”‚ ä¸Šä¼ æ—¥å¿—  â”‚
         â”‚         â”‚           â”‚           â”‚           â”‚
Pipeline â”‚         â”‚           â”‚           â”‚ é”€æ¯Pod   â”‚ failed
å®Œæˆ     â”‚         â”‚           â”‚           â”‚           â”‚
```

### 7.3 é•œåƒä½¿ç”¨ä¸æ•°æ®æµåŠ¨æœºåˆ¶

#### 7.3.1 åŒå±‚é•œåƒæ¶æ„

```yaml
# ä¸¤ä¸ªç‹¬ç«‹çš„é•œåƒæ¦‚å¿µ
Runneré•œåƒ (ç®¡ç†å±‚)
â””â”€â”€ gitlab/gitlab-runner:alpine-v16.6.1
    â””â”€â”€ èŒè´£ï¼šAPIè½®è¯¢ã€Podç®¡ç†ã€æ—¥å¿—ä¸Šä¼ 

Jobé•œåƒ (æ‰§è¡Œå±‚)  
â””â”€â”€ python:3.9 / node:16 / è‡ªå®šä¹‰é•œåƒ
    â””â”€â”€ èŒè´£ï¼šå®é™…æ‰§è¡ŒCI/CDä»»åŠ¡
```

#### 7.3.2 æ•°æ®æµè½¬è¯¦ç»†æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®æµè½¬å…¨æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Stage 1: validate
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validate Job    â”‚  è¾“å…¥: Gitä»“åº“ä»£ç 
â”‚ python:3.9      â”‚  â”œâ”€â”€ main.py
â”‚                 â”‚  â”œâ”€â”€ requirements.txt  
â”‚ æ‰§è¡Œ:           â”‚  â””â”€â”€ .gitlab-ci.yml
â”‚ - è¯­æ³•æ£€æŸ¥      â”‚
â”‚ - ä»£ç é£æ ¼æ£€æŸ¥  â”‚  è¾“å‡º: æ— artifacts
â”‚                 â”‚  çŠ¶æ€: âœ… Success
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

           â†“ (æ— æ•°æ®ä¼ é€’ï¼Œä»…çŠ¶æ€)

Stage 2: build  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ build Job       â”‚  è¾“å…¥: Gitä»“åº“ä»£ç  (è‡ªåŠ¨ä¸‹è½½)
â”‚ node:16         â”‚  â”œâ”€â”€ package.json
â”‚                 â”‚  â”œâ”€â”€ src/
â”‚ æ‰§è¡Œ:           â”‚  â””â”€â”€ webpack.config.js
â”‚ - npm install   â”‚
â”‚ - npm run build â”‚  è¾“å‡º: artifacts
â”‚                 â”‚  â”œâ”€â”€ dist/bundle.js
â”‚                 â”‚  â”œâ”€â”€ dist/index.html
â”‚                 â”‚  â””â”€â”€ package-lock.json
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GitLab      â”‚ â† ä¸Šä¼ artifacts
    â”‚ Artifacts   â”‚
    â”‚ Storage     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
Stage 3: test (å¹¶è¡Œæ‰§è¡Œå¤šä¸ªJob)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unit-test Job   â”‚         â”‚ e2e-test Job    â”‚
â”‚ python:3.9      â”‚         â”‚ cypress:12.0.0  â”‚
â”‚                 â”‚         â”‚                 â”‚
â”‚ è¾“å…¥:           â”‚         â”‚ è¾“å…¥:           â”‚
â”‚ - Gitä»£ç        â”‚         â”‚ - Gitä»£ç        â”‚
â”‚ - buildäº§ç‰©     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”¤ - buildäº§ç‰©     â”‚
â”‚   (è‡ªåŠ¨ä¸‹è½½)    â”‚         â”‚   (è‡ªåŠ¨ä¸‹è½½)    â”‚
â”‚                 â”‚         â”‚                 â”‚
â”‚ æ‰§è¡Œ:           â”‚         â”‚ æ‰§è¡Œ:           â”‚
â”‚ - pytest tests/â”‚         â”‚ - cypress run   â”‚
â”‚                 â”‚         â”‚                 â”‚
â”‚ è¾“å‡º:           â”‚         â”‚ è¾“å‡º:           â”‚
â”‚ - testæŠ¥å‘Š      â”‚         â”‚ - æˆªå›¾/è§†é¢‘     â”‚
â”‚ - è¦†ç›–ç‡æŠ¥å‘Š    â”‚         â”‚ - æµ‹è¯•æŠ¥å‘Š      â”‚
â”‚                 â”‚         â”‚                 â”‚
â”‚ çŠ¶æ€: âœ…Success â”‚         â”‚ çŠ¶æ€: âŒFailed  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä¸Šä¼ æµ‹è¯•    â”‚         â”‚ ä¸Šä¼ å¤±è´¥    â”‚
    â”‚ æŠ¥å‘Š        â”‚         â”‚ ä¿¡æ¯        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Stage 4: deploy (å› ä¸ºtestå¤±è´¥è€Œè·³è¿‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ deploy Job      â”‚  çŠ¶æ€: â¸ Skipped
â”‚ kubectl:latest  â”‚  åŸå› : å‰ç½®Jobå¤±è´¥
â”‚                 â”‚
â”‚ æœ¬åº”æ‰§è¡Œ:       â”‚
â”‚ - æ„å»ºDockeré•œåƒâ”‚
â”‚ - æ¨é€åˆ°ä»“åº“    â”‚
â”‚ - éƒ¨ç½²åˆ°K8s     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 Podç”Ÿå‘½å‘¨æœŸçŠ¶æ€å›¾

```
æ¯ä¸ªJob Podçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ:

Runnerè½®è¯¢åˆ°Job
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Podåˆ›å»ºé˜¶æ®µ     â”‚ çŠ¶æ€: Pending
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€ è°ƒåº¦åˆ°Node
â”‚ â”‚ APIè°ƒç”¨     â”‚ â”‚ â”œâ”€â”€ æ‹‰å–é•œåƒ  
â”‚ â”‚ K8såˆ›å»ºPod  â”‚ â”‚ â””â”€â”€ åˆ›å»ºå®¹å™¨
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Podè¿è¡Œé˜¶æ®µ     â”‚ çŠ¶æ€: Running
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€ ä¸‹è½½artifacts
â”‚ â”‚ åˆå§‹åŒ–å®¹å™¨  â”‚ â”‚ â”œâ”€â”€ è®¾ç½®ç¯å¢ƒå˜é‡
â”‚ â”‚ ä¸‹è½½ä¾èµ–    â”‚ â”‚ â”œâ”€â”€ æ‰§è¡Œscript
â”‚ â”‚ æ‰§è¡Œè„šæœ¬    â”‚ â”‚ â”œâ”€â”€ å®æ—¶ä¸Šä¼ æ—¥å¿—
â”‚ â”‚ æ”¶é›†ç»“æœ    â”‚ â”‚ â””â”€â”€ ä¸Šä¼ artifacts
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Podå®Œæˆé˜¶æ®µ     â”‚ çŠ¶æ€: Succeeded/Failed
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€ å®¹å™¨é€€å‡º
â”‚ â”‚ ä¸Šä¼ æ—¥å¿—    â”‚ â”‚ â”œâ”€â”€ æ”¶é›†é€€å‡ºç 
â”‚ â”‚ æ¸…ç†èµ„æº    â”‚ â”‚ â”œâ”€â”€ æ›´æ–°JobçŠ¶æ€
â”‚ â”‚ é”€æ¯Pod     â”‚ â”‚ â””â”€â”€ é‡Šæ”¾èµ„æº
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
å›åˆ°Runnerç»§ç»­è½®è¯¢ä¸‹ä¸€ä¸ªJob
```

### 7.5 å­˜å‚¨å’Œç¼“å­˜æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­˜å‚¨å’Œç¼“å­˜æœºåˆ¶                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Gitä»“åº“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         æ¯ä¸ªJob Pod              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ 1. ä¸‹è½½æºä»£ç  (git clone)   â”‚ â”‚
        â”‚  â”‚ 2. æ¢å¤cache (å¦‚æœæœ‰)       â”‚ â”‚  â† Cacheå­˜å‚¨
        â”‚  â”‚ 3. ä¸‹è½½artifacts (å¦‚æœéœ€è¦) â”‚ â”‚  â† Artifactså­˜å‚¨
        â”‚  â”‚ 4. æ‰§è¡ŒJobè„šæœ¬              â”‚ â”‚
        â”‚  â”‚ 5. ä¸Šä¼ cache (å¦‚æœé…ç½®)     â”‚ â”‚  â†’ Cacheå­˜å‚¨
        â”‚  â”‚ 6. ä¸Šä¼ artifacts (å¦‚æœé…ç½®) â”‚ â”‚  â†’ Artifactså­˜å‚¨
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å­˜å‚¨å±‚çº§:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gitä»“åº“     â”‚  â”‚ Cacheå­˜å‚¨   â”‚  â”‚ Artifacts   â”‚
â”‚ (æºä»£ç )    â”‚  â”‚ (åŠ é€Ÿæ„å»º)  â”‚  â”‚ (Jobäº§ç‰©)   â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”‚ - æŒä¹…å­˜å‚¨  â”‚  â”‚ - ä¸´æ—¶å­˜å‚¨  â”‚  â”‚ - ä¸´æ—¶å­˜å‚¨  â”‚
â”‚ - ç‰ˆæœ¬æ§åˆ¶  â”‚  â”‚ - Runnerçº§åˆ«â”‚  â”‚ - Pipelineçº§åˆ«â”‚
â”‚ - æ‰€æœ‰Job   â”‚  â”‚ - ç›¸åŒkey   â”‚  â”‚ - Jobé—´ä¼ é€’ â”‚
â”‚   éƒ½èƒ½è®¿é—®  â”‚  â”‚   å…±äº«ç¼“å­˜  â”‚  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6 å¹¶è¡Œæ‰§è¡Œæµç¨‹å›¾

```
Pipelineå¹¶è¡Œæ‰§è¡Œç¤ºä¾‹:

æ—¶é—´ â†’
     â”‚ Stage 1 â”‚    Stage 2     â”‚       Stage 3       â”‚ Stage 4 â”‚
     â”‚         â”‚                â”‚                     â”‚         â”‚
Job1 â”‚validate â”‚                â”‚                     â”‚         â”‚
     â”‚ âœ…      â”‚                â”‚                     â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                â”‚                     â”‚
Job2           â”‚ build          â”‚                     â”‚
               â”‚ âœ…             â”‚                     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚                     â”‚         â”‚
Job3                            â”‚ unit-test           â”‚         â”‚
                                â”‚ âœ…                  â”‚         â”‚
                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                â”‚                     â”‚         â”‚
Job4                            â”‚ lint-test           â”‚         â”‚
                                â”‚ âœ…                  â”‚         â”‚
                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                â”‚                     â”‚         â”‚
Job5                            â”‚ e2e-test            â”‚         â”‚
                                â”‚ âŒ                  â”‚         â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                      â”‚         â”‚
Job6                                                  â”‚ deploy  â”‚
                                                      â”‚ â¸Skip   â”‚
                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®ä¾èµ–å…³ç³»:
validate â†’ build â†’ [unit-test, lint-test, e2e-test] â†’ deploy
   â†“        â†“              â†“         â†“         â†“         â†“
  æ— äº§ç‰©   äº§ç”Ÿdist/     éœ€è¦dist/  éœ€è¦dist/  éœ€è¦dist/  éœ€è¦å…¨éƒ¨æˆåŠŸ
```

### 7.7 é”™è¯¯å¤„ç†å’Œé‡è¯•æµç¨‹

```
Jobæ‰§è¡Œå¤±è´¥å¤„ç†æµç¨‹:

Jobå¼€å§‹æ‰§è¡Œ
     â†“
æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é”™è¯¯ç±»å‹åˆ¤æ–­    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ è„šæœ¬æ‰§è¡Œå¤±è´¥  â”‚ â†’ æ ‡è®°Job Failed
â”‚ â€¢ è¶…æ—¶          â”‚ â†’ æ ‡è®°Job Failed  
â”‚ â€¢ é•œåƒæ‹‰å–å¤±è´¥  â”‚ â†’ é‡è¯•/æ ‡è®°Failed
â”‚ â€¢ èµ„æºä¸è¶³      â”‚ â†’ ç­‰å¾…/é‡è¯•
â”‚ â€¢ ç½‘ç»œé—®é¢˜      â”‚ â†’ é‡è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡è¯•ç­–ç•¥        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ retry:          â”‚
â”‚   max: 2        â”‚ â†’ æœ€å¤šé‡è¯•2æ¬¡
â”‚   when:         â”‚
â”‚   - runner_     â”‚ â†’ åªåœ¨ç³»ç»Ÿé”™è¯¯æ—¶é‡è¯•
â”‚     system_     â”‚
â”‚     failure     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
é‡è¯•æ¬¡æ•°ç”¨å®Œæˆ–æ‰‹åŠ¨æ ‡è®°å¤±è´¥
     â†“
PipelineçŠ¶æ€æ›´æ–°ä¸ºFailed
```

### 7.8 å…³é”®è¿è¡ŒåŸç†æ€»ç»“

**æ‰§è¡Œæ¨¡å‹ï¼š**
- **1ä¸ªRunner Podï¼ˆå¸¸é©»ï¼‰+ Nä¸ªJob Podï¼ˆæŒ‰éœ€åˆ›å»ºé”€æ¯ï¼‰**
- Runner Podè´Ÿè´£ç®¡ç†ï¼ŒJob Podè´Ÿè´£æ‰§è¡Œ
- æ¯ä¸ªJobéƒ½åœ¨ç‹¬ç«‹çš„Podä¸­è¿è¡Œï¼Œç¡®ä¿éš”ç¦»æ€§

**çŠ¶æ€æµè½¬ï¼š**
- **created â†’ pending â†’ running â†’ success/failed**
- PipelineçŠ¶æ€ç”±æ‰€æœ‰JobçŠ¶æ€å†³å®š
- å¤±è´¥çš„Jobä¼šå½±å“åç»­ä¾èµ–çš„Job

**æ•°æ®æµåŠ¨ï¼š**
- **é€šè¿‡GitLabæœåŠ¡å™¨ä¸­è½¬artifactsï¼Œä¸æ˜¯Podç›´æ¥é€šä¿¡**
- Cacheç”¨äºåŠ é€Ÿæ„å»ºï¼ŒArtifactsç”¨äºJobé—´æ•°æ®ä¼ é€’
- Gitä»“åº“ä»£ç æ¯ä¸ªJobéƒ½ä¼šé‡æ–°ä¸‹è½½

**å¹¶è¡Œæœºåˆ¶ï¼š**
- **ç›¸åŒstageå†…çš„Jobå¯å¹¶è¡Œï¼Œä¸åŒstageæŒ‰ä¾èµ–é¡ºåºæ‰§è¡Œ**
- é€šè¿‡needså…³é”®å­—æ§åˆ¶ç²¾ç¡®çš„ä¾èµ–å…³ç³»
- èµ„æºå…è®¸çš„æƒ…å†µä¸‹æœ€å¤§åŒ–å¹¶è¡Œæ‰§è¡Œ

**èµ„æºç®¡ç†ï¼š**
- **æ¯ä¸ªJobç‹¬ç«‹Podï¼Œå®Œæˆåç«‹å³æ¸…ç†**
- ä¸´æ—¶å­˜å‚¨éšPodé”€æ¯ï¼ŒæŒä¹…æ•°æ®é€šè¿‡artifactsä¿å­˜
- Runner Podå¤ç”¨ï¼Œå‡å°‘èµ„æºæ¶ˆè€—

---

## 8. Pythonä»£ç è¯„æµ‹ç³»ç»Ÿ

### 8.1 è¯„æµ‹ç³»ç»Ÿæ¶æ„

```
æäº¤ä»£ç  â†’ GitLab â†’ Runneråˆ›å»ºPod â†’ ç¼–è¯‘æ‰§è¡Œ â†’ è¯„æµ‹ç¨‹åº â†’ ç»“æœè¾“å‡º
    â†“           â†“         â†“           â†“         â†“         â†“
  python     è§¦å‘CI    éš”ç¦»ç¯å¢ƒ     è¿è¡Œä»£ç    åˆ¤åˆ†ç³»ç»Ÿ   åˆ†æ•°/æŠ¥å‘Š
   æ–‡ä»¶      pipeline    å®¹å™¨       è·å–è¾“å‡º   æ¯”å¯¹ç»“æœ    å­˜å‚¨
```

### 7.2 CI/CD Pipelineé…ç½®

```yaml
# .gitlab-ci.yml
stages:
  - validate    # ä»£ç éªŒè¯
  - test        # è¿è¡Œæµ‹è¯•
  - judge       # è¯„æµ‹åˆ¤åˆ†

variables:
  PYTHON_VERSION: "3.9"
  TIMEOUT: "30"
  MEMORY_LIMIT: "512m"

# ä»£ç éªŒè¯é˜¶æ®µ
validate-code:
  stage: validate
  image: python:3.9-alpine
  tags: [kubernetes]
  script:
    - python -m py_compile *.py
    - pip install flake8
    - flake8 --max-line-length=120 *.py

# è¿è¡Œæµ‹è¯•é˜¶æ®µ
run-tests:
  stage: test
  image: python:3.9-alpine
  tags: [kubernetes]
  script:
    - ./run_testcases.sh
  artifacts:
    paths: [outputs/, logs/]
    expire_in: 1 day
  parallel:
    matrix:
      - TESTCASE: [case1, case2, case3, case4, case5]

# è¯„æµ‹åˆ¤åˆ†é˜¶æ®µ
judge-results:
  stage: judge
  image: python:3.9-alpine
  tags: [kubernetes]
  script:
    - python judge.py
    - python generate_report.py
  artifacts:
    paths: [judge_result.json, report.html]
    reports:
      junit: judge_result.xml
```

### 7.3 å®‰å…¨æ‰§è¡Œè„šæœ¬

```bash
#!/bin/bash
# run_testcases.sh - å®‰å…¨è¿è¡ŒPythonä»£ç 

set -e

PYTHON_FILE=${1:-"solution.py"}
TESTCASE=${TESTCASE:-"case1"}
TIMEOUT=${TIMEOUT:-30}

echo "Running testcase: $TESTCASE"
mkdir -p outputs logs

run_with_limits() {
    local input_file="testcases/${TESTCASE}/input.txt"
    local output_file="outputs/${TESTCASE}_output.txt"
    local log_file="logs/${TESTCASE}_log.txt"
    
    # èµ„æºé™åˆ¶
    (
        ulimit -v 524288    # 512MBå†…å­˜é™åˆ¶
        ulimit -t $TIMEOUT  # CPUæ—¶é—´é™åˆ¶
        ulimit -f 10240     # 10MBæ–‡ä»¶å¤§å°é™åˆ¶
        
        timeout ${TIMEOUT}s python3 "$PYTHON_FILE" \
            < "$input_file" > "$output_file" 2> "$log_file"
    )
    
    return $?
}

if run_with_limits; then
    echo "âœ… Testcase $TESTCASE: SUCCESS"
else
    echo "âŒ Testcase $TESTCASE: FAILED"
fi
```

### 7.4 è¯„æµ‹ç¨‹åºå®ç°

```python
#!/usr/bin/env python3
# judge.py - è¯„æµ‹åˆ¤åˆ†ç¨‹åº

import os
import json
import difflib
from pathlib import Path

class Judge:
    def __init__(self):
        self.testcases_dir = Path("testcases")
        self.outputs_dir = Path("outputs")
        self.results = []
        
    def compare_output(self, expected_file, actual_file, case_name):
        """æ¯”è¾ƒæœŸæœ›è¾“å‡ºå’Œå®é™…è¾“å‡º"""
        try:
            with open(expected_file, 'r') as f:
                expected = f.read().strip()
            with open(actual_file, 'r') as f:
                actual = f.read().strip()
                
            # ç²¾ç¡®åŒ¹é…
            if expected == actual:
                return {"status": "AC", "score": 100, "message": "Accepted"}
            
            # æµ®ç‚¹æ•°å®¹é”™
            if self.compare_floating_point(expected, actual):
                return {"status": "AC", "score": 100, "message": "Accepted (float tolerance)"}
            
            # éƒ¨åˆ†åŒ¹é…
            similarity = difflib.SequenceMatcher(None, expected, actual).ratio()
            if similarity > 0.8:
                return {"status": "PA", "score": int(similarity * 100), 
                       "message": f"Partially Accepted ({similarity:.2%})"}
            else:
                return {"status": "WA", "score": 0, "message": "Wrong Answer"}
                
        except FileNotFoundError:
            return {"status": "RE", "score": 0, "message": "Runtime Error"}
    
    def judge_all_cases(self):
        """è¯„æµ‹æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹"""
        total_score = 0
        total_cases = 0
        
        for case_dir in self.testcases_dir.iterdir():
            if case_dir.is_dir():
                case_name = case_dir.name
                expected_file = case_dir / "output.txt"
                actual_file = self.outputs_dir / f"{case_name}_output.txt"
                
                result = self.compare_output(expected_file, actual_file, case_name)
                result["case"] = case_name
                
                self.results.append(result)
                total_score += result["score"]
                total_cases += 1
                
        final_score = total_score / total_cases if total_cases > 0 else 0
        
        summary = {
            "final_score": final_score,
            "total_cases": total_cases,
            "results": self.results
        }
        
        with open("judge_result.json", "w") as f:
            json.dump(summary, f, indent=2)
            
        print(f"ğŸ¯ Final Score: {final_score:.1f}%")
        return summary

if __name__ == "__main__":
    judge = Judge()
    result = judge.judge_all_cases()
    
    # è®¾ç½®CI/CDé€€å‡ºç 
    exit(0 if result["final_score"] >= 60 else 1)
```

---

## 9. GitLab CI/CDé…ç½®è¯¦è§£

### 9.1 å…³é”®å­—åˆ†ç±»

| ç±»å‹ | ç¤ºä¾‹ | å¯è‡ªå®šä¹‰ç¨‹åº¦ | è¯´æ˜ |
|------|------|-------------|------|
| **å›ºå®šå…³é”®å­—** | `script`, `image`, `stage` | âŒ ä¸å¯æ›´æ”¹ | GitLabé¢„å®šä¹‰ |
| **Jobåç§°** | `test-python`, `æˆ‘çš„ä»»åŠ¡` | âœ… å®Œå…¨è‡ªå®šä¹‰ | ä»»æ„å‘½å |
| **Stageåç§°** | `build`, `test`, `éƒ¨ç½²é˜¶æ®µ` | âœ… å®Œå…¨è‡ªå®šä¹‰ | ä»»æ„å‘½å |
| **å˜é‡å** | `MY_VAR`, `PYTHON_VERSION` | âœ… å®Œå…¨è‡ªå®šä¹‰ | ç”¨æˆ·å®šä¹‰ |
| **æŸäº›å€¼** | `when: on_success` | âŒ é¢„å®šä¹‰é€‰é¡¹ | å›ºå®šå¯é€‰å€¼ |

### 9.2 å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# æ··åˆä½¿ç”¨å›ºå®šå…³é”®å­—å’Œè‡ªå®šä¹‰å€¼
stages:                        # å›ºå®šå…³é”®å­—
  - å®‰å…¨æ£€æŸ¥                    # è‡ªå®šä¹‰stageåç§°
  - å•å…ƒæµ‹è¯•                    # è‡ªå®šä¹‰stageåç§°

variables:                     # å›ºå®šå…³é”®å­—
  æ•°æ®åº“ç±»å‹: "postgresql"       # è‡ªå®šä¹‰å˜é‡
  æµ‹è¯•è¶…æ—¶: "300"               # è‡ªå®šä¹‰å˜é‡

æˆ‘å…¬å¸çš„Pythonè´¨é‡æ£€æŸ¥:         # è‡ªå®šä¹‰Jobåç§°
  stage: å®‰å…¨æ£€æŸ¥              # å›ºå®šå…³é”®å­—ï¼Œå¼•ç”¨è‡ªå®šä¹‰stage
  image: python:3.9            # å›ºå®šå…³é”®å­—ï¼Œè‡ªå®šä¹‰é•œåƒ
  tags: [kubernetes, é«˜æ€§èƒ½èŠ‚ç‚¹] # å›ºå®šå…³é”®å­—ï¼Œè‡ªå®šä¹‰tag
  script:                      # å›ºå®šå…³é”®å­—
    - pip install bandit       # è‡ªå®šä¹‰è„šæœ¬
    - bandit -r . -f json      # è‡ªå®šä¹‰è„šæœ¬
  artifacts:                   # å›ºå®šå…³é”®å­—
    when: always               # å›ºå®šå€¼é€‰é¡¹
    paths: [å®‰å…¨æŠ¥å‘Š.json]       # è‡ªå®šä¹‰è·¯å¾„
  rules:                       # å›ºå®šå…³é”®å­—
    - if: $CI_COMMIT_BRANCH == "main"
      when: always             # å›ºå®šå€¼é€‰é¡¹
```

### 9.3 é¢„å®šä¹‰å˜é‡

```yaml
# GitLabæä¾›çš„å†…ç½®å˜é‡ï¼ˆåªè¯»ï¼‰
script:
  - echo $CI_PIPELINE_ID       # Pipeline ID
  - echo $CI_JOB_NAME          # Jobåç§°
  - echo $CI_PROJECT_PATH      # é¡¹ç›®è·¯å¾„
  - echo $CI_COMMIT_SHA        # æäº¤å“ˆå¸Œ
  - echo $GITLAB_USER_EMAIL    # ç”¨æˆ·é‚®ç®±
  - echo $CI_NODE_INDEX        # å¹¶è¡Œä»»åŠ¡ç´¢å¼•
```

---

## 10. å®‰å…¨å’Œæœ€ä½³å®è·µ

### 10.1 Podå®‰å…¨é…ç½®

```yaml
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  containers:
  - name: runner-build
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop: [ALL]
    resources:
      limits:
        cpu: "1"
        memory: "1Gi"
        ephemeral-storage: "1Gi"
```

### 10.2 ç½‘ç»œå®‰å…¨

```yaml
# NetworkPolicyç¤ºä¾‹
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: gitlab-network-policy
  namespace: gitlab
spec:
  podSelector:
    matchLabels:
      app: gitlab
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    ports:
    - protocol: TCP
      port: 80
```

### 10.3 å¯†é’¥ç®¡ç†

```yaml
# æ•æ„Ÿä¿¡æ¯ä½¿ç”¨Secret
apiVersion: v1
kind: Secret
metadata:
  name: gitlab-secrets
  namespace: gitlab
type: Opaque
data:
  root-password: <base64-encoded>
  db-password: <base64-encoded>
  registry-password: <base64-encoded>
```

---

## 11. æ•…éšœæ’æŸ¥æŒ‡å—

### 11.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| Podåˆ›å»ºå¤±è´¥ | RBACæƒé™ä¸è¶³ | æ£€æŸ¥ServiceAccountæƒé™ |
| é•œåƒæ‹‰å–å¤±è´¥ | ç½‘ç»œæˆ–æƒé™é—®é¢˜ | é…ç½®é•œåƒä»“åº“å‡­è¯ |
| Runnerä¸æ‰§è¡ŒJob | æ ‡ç­¾ä¸åŒ¹é… | æ£€æŸ¥tagsé…ç½® |
| Jobè¶…æ—¶ | èµ„æºé™åˆ¶è¿‡ä½ | å¢åŠ CPU/å†…å­˜é™åˆ¶ |
| å­˜å‚¨æŒ‚è½½å¤±è´¥ | PVCé…ç½®é”™è¯¯ | æ£€æŸ¥StorageClass |

### 11.2 è°ƒè¯•å‘½ä»¤

```bash
# æŸ¥çœ‹GitLabçŠ¶æ€
kubectl get pods -n gitlab
kubectl describe pod gitlab-xxx -n gitlab

# æŸ¥çœ‹Runneræ—¥å¿—
kubectl logs -f gitlab-runner-xxx -n gitlab

# æŸ¥çœ‹å­˜å‚¨çŠ¶æ€
kubectl get pvc -n gitlab
kubectl describe pvc gitlab-data-pvc -n gitlab

# è¿›å…¥å®¹å™¨è°ƒè¯•
kubectl exec -it gitlab-xxx -n gitlab -- /bin/bash

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
kubectl get svc -n gitlab
kubectl get ingress -n gitlab
```

### 11.3 æ€§èƒ½ç›‘æ§

```yaml
# èµ„æºä½¿ç”¨ç›‘æ§
kubectl top pods -n gitlab
kubectl top nodes

# æŸ¥çœ‹äº‹ä»¶
kubectl get events -n gitlab --sort-by='.lastTimestamp'

# æŸ¥çœ‹èµ„æºé…é¢
kubectl describe quota -n gitlab
```

---

## æ€»ç»“

æœ¬æŒ‡å—æ¶µç›–äº†GitLabåœ¨Kubernetesä¸Šçš„å®Œæ•´éƒ¨ç½²æµç¨‹ï¼Œä»åŸºç¡€æ¶æ„è®¾è®¡åˆ°é«˜çº§åŠŸèƒ½å®ç°ã€‚ä¸»è¦ç‰¹ç‚¹ï¼š

1. **å®Œæ•´æ€§**ï¼šè¦†ç›–éƒ¨ç½²ã€é…ç½®ã€è¿ç»´å…¨æµç¨‹
2. **å®ç”¨æ€§**ï¼šæä¾›ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„é…ç½®ç¤ºä¾‹
3. **å®‰å…¨æ€§**ï¼šåŒ…å«å®‰å…¨æœ€ä½³å®è·µ
4. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒä»å°å‹å›¢é˜Ÿåˆ°ä¼ä¸šçº§åº”ç”¨

å»ºè®®æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œå¹¶æ ¹æ®å›¢é˜Ÿè§„æ¨¡å’Œä½¿ç”¨åœºæ™¯è¿›è¡Œç›¸åº”è°ƒæ•´ã€‚